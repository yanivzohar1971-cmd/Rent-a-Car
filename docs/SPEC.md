# אפיון מערכת – אפליקציית הזמנות השכרת רכב (Android)

*מחבר: Yaniv Zohar & ChatGPT • גרסה 2.0 • שפה: עברית (RTL)*

---

## 1) תקציר מנהלים

אפליקציית אנדרואיד תפעולית ליצירה, שליחה ומעקב אחר הזמנות השכרת רכב לספקים שונים. האפליקציה תפיק טופס ייצוגי (PDF) או טקסט מובנה לשיתוף ב־WhatsApp/Email, תקלוט בחזרה מספר הזמנה מהספק ותנהל מעקב תשלומים ועמלות (יומי/שבועי/חודשי) כולל יבוא דוחות ספקים. דגש על פרטיות ואבטחת מידע: **לא שומרים PAN/CVV**, הצפנה מקומית מלאה. בשלב זה אין חיוב ישיר ללקוח – החיוב מתבצע רק מול חברת ההשכרה.

---

## 2) מטרות וגבולות (Scope)

**מטרות**

- יצירה מהירה ומסודרת של הזמנות השכרה.
- שליחה ל־ספק/לקוח כ־PDF מעוצב או כטקסט מובנה.
- קליטת מספר הזמנה, סטטוס ותשלומים.
- חישוב עמלות חכם לפי כללים עסקיים (יומי/שבועי/חודשי + חודשי מתמשך 7%).
- דוחות פילוח לפי ספק/תקופה וייצוא CSV/Excel.

**מחוץ לסקופ בשלב א׳**

- סליקה/חיוב לקוחות מתוך האפליקציה.
- API חיצוני ל־WhatsApp Business – לשלב מתקדם.

---

## 3) פרסונות עיקריות

- נציג/ת הזמנות: יוצר/ת הזמנה, שולח/ת לספק/לקוח, מקבל/ת מספר הזמנה.
- מנהל/ת כספים: בודק/ת דוחות, מייבא/ת דוחות ספקים, מסמן/ת שולם, עוקב/ת אחר עמלות.
- מנהל/ת מערכת: מגדיר/ה ספקים, סניפים, סוגי רכב, כללי עמלות, ברירות מחדל.

---

## 4) תרשים זרימה (טקסטואלי)

1. יצירת הזמנה → 2. בחירת אופן שליחה: PDF (ברירת מחדל) / טקסט → 3. שליחה ל־ספק (וואטסאפ/מייל) + ללקוח (PDF באימייל/וואטסאפ אופציונלי) → 4. קליטת מס׳ הזמנה מהספק ועדכון סטטוס → 5. מעקב תשלומים + חישוב עמלות → 6. דוחות/ייצוא → 7. (שלב ב׳) יבוא דוחות ספק.

---

## 5) מסכים ופונקציונליות

### 5.1 מסך בית (Dashboard)

- סטטוס הזמנות פתוחות, התראות (אין מס׳ הזמנה >48ש׳).
- קיצורי דרך: הזמנה חדשה, דוחות, יבוא דוחות.

### 5.2 יצירת הזמנה (Form)

שדות:

1. שם (חובה)
2. שם משפחה (חובה)
3. טל׳ (חובה)
4. מספר ת"ז (רשות)
5. כתובת (רשות)
6. פרטי כרטיס אשראי – Stub בלבד או לינק מאובטח; אין חיוב ללקוח
7. אימייל (רשות)
8. מתאריך – עד תאריך (חובה)
9. סוג רכב (חובה)
10. מחיר מסוכם (חובה)
11. ק"מ כלול (חובה)
12. סניף קבלת רכב (חובה)
13. חברה מספקת (חובה)
14. מסגרת אשראי נדרשת (חובה, מינ׳ 2,000 ₪, ניתן לעלות או לנעול ע"י הספק)

פעולות:

- שמירת טיוטה.
- שליחה כטקסט / PDF.
- שיתוף לספק/לקוח.

### 5.3 מסך הזמנה קיימת

- הצגת כל פרטי ההזמנה.
- סטטוס: Draft / SentToSupplier / SentToCustomer / Confirmed / Paid / Cancelled.
- שדה: מס׳ הזמנה מהספק (Editable).
- כפתור: סמן שולם + פירוט תשלום.

### 5.4 תנאים והגבלות

1. רישיון נהיגה מקורי בתוקף.
2. תעודת זהות.
3. כרטיס אשראי עם מסגרת פנויה (מינ׳ 2,000 ₪ או לפי מדיניות הספק).
4. החברה אינה מתחייבת לדגם או צבע.

### 5.5 מעקב תשלומים ודוחות

- פילוח לפי ספק.
- חישוב עמלות (יומי/שבועי/חודשי).
- יצוא CSV/Excel.

### 5.6 יבוא דוחות ספק (שלב ב׳)

- העלאת קובץ CSV/Excel.
- התאמת עמודות להזמנות.
- עדכון סטטוס "שולם" והוספת רשומות תשלום.

### 5.7 הגדרות מערכת

- ספקים (שם, טל׳, ברירת מחדל למסגרת, נעילה לסכום קבוע).
- סניפים (שם, כתובת, ספק).
- סוגי רכב (רשימה).
- עמלות (עריכה). ברירת מחדל נשמרת להזמנות קיימות.

---

## 6) כללי עמלות

- יומי: 1–6 ימים → 15%.
- שבועי: 7–23 ימים → 10%.
- חודשי: 24+ ימים → 7%.
- חודשי מתמשך: 7% לחודש נוסף (פרו־ראטה).

---

## 7) ולידציות

- טל׳ תקין (IL/בינ"ל).
- ת"ז: אם הוזן – אימות בסיסי.
- אימייל: אם הוזן – אימות תקין.
- מחיר ≥ 0.
- תאריכים תקינים.
- מסגרת ≥ 2,000 ₪.

---

## 8) אבטחה ופרטיות

- אין אחסון PAN/CVV.
- הצפנת DB + הגדרות.
- מסכי לקוח רגישים עם FLAG_SECURE.
- מידע אישי (PII) מינימלי – ת"ז ואימייל רק אם הוזנו.
- אין חיוב ללקוח, החיוב מול הספק בלבד.

---

## 9) תבניות שליחה

טקסט מובנה לספק:

```
הזמנת השכרת רכב:
שם: {firstName} {lastName}
טל׳: {phone}
{ת"ז אם הוזן}
{אימייל אם הוזן}
מתאריך: {from} עד {to} ({days} ימים)
סוג רכב: {carType}
מחיר: ₪{price}
ק"מ כלול: {kmIncluded}
סניף קבלה: {branch}
חברה מספקת: {supplier}
מסגרת אשראי נדרשת: ₪{holdAmount}{holdNote}
```

PDF ללקוח:

- לוגו, פרטי הזמנה, תנאים, חתימה, QR.

---

## 10) מודל נתונים (Room)

- Customer: firstName, lastName, phone, tzId?, address?, email?
- Supplier: defaultHold, fixedHold.
- Branch: name, supplierId.
- CarType: name.
- Reservation: dateFrom, dateTo, agreedPrice, kmIncluded, requiredHoldAmount, status, supplierOrderNumber.
- Payment: amount, date, method, note.
- CardStub: brand, last4, expMonth?, expYear?.
- CommissionRule: minDays, maxDays, percent.

---

## 11) ארכיטקטורה

- Kotlin, Jetpack Compose, Room, DataStore, WorkManager.
- MVVM + Repository.
- RTL, i18n.

---

## 12) התראות

- אין מס׳ הזמנה >48ש׳.
- חודשי מתמשך.
- פערי תשלום (אם קיימת אינטגרציה).

---

## 13) דרישות לא תפקודיות

- Offline-first.
- ביצועים ≤ 500ms ל־1,000 רשומות.
- תאימות Android 8.0+.
- נגישות מלאה.

---

## 14) Roadmap

- שלב א׳: הזמנות, שליחה, PDF/טקסט, דוחות בסיס.
- שלב ב׳: יבוא דוחות ספק.
- שלב ג׳: אינטגרציות חיצוניות (API/תשלום מאובטח).

---

## 15) Definition of Done

- כל השדות עובדים בהתאם (חובה/רשות).
- PDF/טקסט נשלחים בהצלחה.
- עמלות מחושבות נכון.
- אבטחה וולידציות תקינים.

---

סיום אפיון גרסה 2.0 – מוכן לפיתוח שלב א׳.
